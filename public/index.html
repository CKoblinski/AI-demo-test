<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D&D Shorts Factory</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>D&D Shorts Factory</h1>
    <p class="subtitle">Drop a Zoom transcript, get pixel art dialogue scenes</p>
  </header>

  <main id="app">
    <!-- Screen 1: Upload -->
    <section id="screen-upload" class="screen active">
      <div class="upload-card">
        <div id="drop-zone" class="drop-zone">
          <div class="drop-icon">&#x1F3AC;</div>
          <p>Drop your <strong>.vtt</strong> file here</p>
          <p class="drop-sub">or click to browse</p>
          <input type="file" id="file-input" accept=".vtt" hidden>
        </div>

        <div class="context-box">
          <label for="user-context">What was important this episode? <span class="optional">(optional)</span></label>
          <textarea id="user-context" rows="3" placeholder="e.g., Bixie found the corruption ledger, there was a big fight with Vexus, Lex rolled a nat 20 on perception..."></textarea>
        </div>

        <button id="submit-btn" class="btn-primary" disabled>Analyze Transcript</button>
      </div>

      <div id="recent-sessions" class="recent-sessions">
        <h3>Recent Sessions</h3>
        <div id="sessions-list"></div>
      </div>
    </section>

    <!-- Screen 2: Analyzing -->
    <section id="screen-analyzing" class="screen">
      <div class="status-card">
        <div class="spinner"></div>
        <h2 id="analyze-message">Analyzing transcript...</h2>
        <div class="progress-bar">
          <div id="analyze-progress" class="progress-fill" style="width: 0%"></div>
        </div>
        <p class="estimate">This usually takes about 2 minutes</p>
      </div>
    </section>

    <!-- Screen 3: Moment Selector -->
    <section id="screen-plan" class="screen">
      <h2>Pick a Moment</h2>
      <p class="plan-intro">We found these cinematic moments in your session. Select one, add direction, and we'll generate a pixel art dialogue scene.</p>

      <div id="moments-list" class="moments-list"></div>

      <div class="direction-box">
        <label for="direction-text">Creative Direction</label>
        <textarea id="direction-text" rows="4" placeholder="Describe the characters (e.g. 'Bixie is a short blonde wood elf rogue with an Attack on Titan-style military outfit'). Add mood or setting notes. Anything you want the pixel art to capture."></textarea>
      </div>

      <div class="plan-actions">
        <button id="generate-btn" class="btn-primary" disabled>Plan Sequences</button>
        <p class="estimate">Director AI plans the animation sequences, then you review before generating</p>
      </div>
    </section>

    <!-- Screen 3.5: Storyboard Review & Editor -->
    <section id="screen-storyboard" class="screen">
      <h2>Storyboard Editor</h2>
      <p class="storyboard-intro">Review and edit the Director AI's sequence plan. Change types, rewrite descriptions, reorder, or add new sequences.</p>

      <div id="storyboard-sequences" class="storyboard-sequences"></div>

      <div class="sb-add-row">
        <button id="add-sequence-btn" class="btn-secondary sb-add-btn">+ Add Sequence</button>
      </div>

      <div id="storyboard-summary" class="storyboard-summary"></div>

      <div id="storyboard-scene-context" class="storyboard-scene-context"></div>

      <div id="storyboard-qc" class="storyboard-qc"></div>

      <div class="storyboard-actions">
        <button id="approve-storyboard-btn" class="btn-primary">Save &amp; Generate</button>
        <button id="replan-btn" class="btn-secondary">Re-plan with Different Direction</button>
        <button id="back-to-moments-btn" class="btn-secondary">Back to Moments</button>
      </div>
    </section>

    <!-- Screen 4: Generating -->
    <section id="screen-generating" class="screen">
      <h2>Building Your Scene</h2>
      <p class="gen-intro">Generating pixel art assets via Gemini...</p>

      <!-- Legacy single-scene progress (hidden when using multi-sequence) -->
      <div id="gen-steps" class="gen-steps">
        <div class="gen-step" id="step-portrait">
          <div class="gen-step-icon"></div>
          <div class="gen-step-info">
            <div class="gen-step-label">Character Portrait</div>
            <div class="gen-step-detail" id="step-portrait-detail"></div>
          </div>
          <div class="gen-step-thumb" id="step-portrait-thumb"></div>
        </div>
        <div class="gen-step" id="step-mouthVariants">
          <div class="gen-step-icon"></div>
          <div class="gen-step-info">
            <div class="gen-step-label">Mouth Variants (x2)</div>
            <div class="gen-step-detail" id="step-mouthVariants-detail"></div>
          </div>
        </div>
        <div class="gen-step" id="step-background">
          <div class="gen-step-icon"></div>
          <div class="gen-step-info">
            <div class="gen-step-label">Scene Background</div>
            <div class="gen-step-detail" id="step-background-detail"></div>
          </div>
          <div class="gen-step-thumb" id="step-background-thumb"></div>
        </div>
        <div class="gen-step" id="step-assembly">
          <div class="gen-step-icon"></div>
          <div class="gen-step-info">
            <div class="gen-step-label">Assemble Scene</div>
            <div class="gen-step-detail" id="step-assembly-detail"></div>
          </div>
        </div>
        <div class="gen-step" id="step-export">
          <div class="gen-step-icon"></div>
          <div class="gen-step-info">
            <div class="gen-step-label">Export Video</div>
            <div class="gen-step-detail" id="step-export-detail"></div>
          </div>
        </div>
      </div>

      <!-- Multi-sequence progress (shown when storyboard exists) -->
      <div id="gen-sequences" class="gen-sequences" style="display: none"></div>

      <div class="progress-bar" style="margin-top: 24px">
        <div id="gen-progress" class="progress-fill" style="width: 0%"></div>
      </div>
      <p id="gen-message" class="estimate"></p>
      <p id="gen-cost" class="estimate"></p>
      <div class="gen-actions">
        <button id="cancel-gen-btn" class="btn-secondary btn-cancel">Cancel Generation</button>
      </div>
    </section>

    <!-- Screen 5: Results -->
    <section id="screen-results" class="screen">
      <h2>Your Scene</h2>

      <div id="result-preview" class="result-preview"></div>

      <div id="result-assets" class="result-assets"></div>

      <div class="results-actions">
        <button id="download-btn" class="btn-primary">Download All (ZIP)</button>
        <button id="edit-regen-btn" class="btn-secondary">Edit Direction &amp; Regenerate</button>
        <button id="pick-another-btn" class="btn-secondary">Pick Another Moment</button>
        <button id="new-session-btn" class="btn-secondary">New Session</button>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
